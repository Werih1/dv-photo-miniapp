<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DV Photo Validator Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script async defer src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api@1.7.13/dist/face-api.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #2481cc;
            --tg-theme-button-color: #2481cc;
            --tg-theme-button-text-color: #ffffff;
            --primary-blue: #2196F3;
            --success-green: #4CAF50;
            --error-red: #F44336;
            --warning-orange: #FF9800;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .app-container {
            max-width: 100vw;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Splash Screen */
        .splash-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            animation: fadeIn 0.5s;
        }

        .splash-logo {
            max-width: 280px;
            max-height: 280px;
            width: 90%;
            height: auto;
            object-fit: contain;
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease-in-out;
        }

        .splash-title {
            font-size: 28px;
            font-weight: bold;
            color: white;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .splash-subtitle {
            font-size: 16px;
            color: rgba(255,255,255,0.9);
            text-align: center;
            margin-bottom: 40px;
        }

        /* Main Screen */
        .main-screen {
            padding: 20px;
            display: none;
        }

        .main-screen.active {
            display: block;
            animation: slideIn 0.3s;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .attempts-counter {
            display: inline-block;
            padding: 8px 16px;
            background: var(--primary-blue);
            color: white;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .button {
            width: 100%;
            padding: 16px;
            margin-bottom: 12px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .button:active {
            transform: scale(0.98);
        }

        .button-secondary {
            background: #f5f5f5;
            color: #333;
        }

        .button-success {
            background: var(--success-green);
        }

        /* Photo Upload Screen */
        .photo-screen {
            display: none;
            padding: 20px;
        }

        .photo-screen.active {
            display: block;
            animation: slideIn 0.3s;
        }

        .back-button {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            color: var(--primary-blue);
            cursor: pointer;
            font-size: 16px;
        }

        .back-button svg {
            margin-right: 8px;
        }

        .photo-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin: 0 auto 20px;
            background: #f0f0f0;
            border-radius: 12px;
            overflow: hidden;
            aspect-ratio: 1;
        }

        .photo-preview {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: contain;
        }

        .photo-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: grab;
        }

        .photo-canvas:active {
            cursor: grabbing;
        }

        .line-info {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .line-info p {
            margin: 8px 0;
            font-size: 14px;
            color: #666;
        }

        .line-info .detected {
            color: var(--success-green);
            font-weight: bold;
        }

        .line-info .manual {
            color: var(--warning-orange);
            font-weight: bold;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading-spinner.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .validation-results {
            display: none;
            margin-top: 20px;
        }

        .validation-results.active {
            display: block;
        }

        .result-status {
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .result-status.success {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success-green);
            border: 2px solid var(--success-green);
        }

        .result-status.error {
            background: rgba(244, 67, 54, 0.1);
            color: var(--error-red);
            border: 2px solid var(--error-red);
        }

        .criteria-list {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .criteria-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .criteria-item:last-child {
            border-bottom: none;
        }

        .criteria-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .criteria-label {
            flex: 1;
            font-size: 14px;
        }

        .criteria-value {
            font-size: 14px;
            font-weight: 500;
            color: #666;
        }

        .hidden-input {
            display: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Splash Screen -->
        <div class="splash-screen" id="splashScreen">
            <img class="splash-logo" src="https://raw.githubusercontent.com/Werih1/dv-photo-miniapp/main/images/dv-lottery-logo.jpg" alt="DV Lottery Logo" id="splashLogo">
            <div class="splash-title">DV Photo Validator</div>
            <div class="splash-subtitle">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ç–æ –¥–ª—è –ª–æ—Ç–µ—Ä–µ–∏ Green Card</div>
        </div>

        <!-- Main Screen -->
        <div class="main-screen" id="mainScreen">
            <div class="header">
                <h1 class="header-title">DV Photo Check</h1>
                <div class="attempts-counter">
                    –ü–æ–ø—ã—Ç–æ–∫: <span id="attemptsCount">3</span>
                </div>
            </div>
            <button class="button" id="uploadPhotoBtn">üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</button>
            <button class="button button-secondary" id="instructionsBtn">üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</button>
        </div>

        <!-- Photo Upload Screen -->
        <div class="photo-screen" id="photoScreen">
            <div class="back-button" id="backFromPhoto">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                –ù–∞–∑–∞–¥
            </div>

            <input type="file" id="photoInput" class="hidden-input" accept="image/*">
            
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
                <div>–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –ª–∏—Ü–æ...</div>
            </div>

            <div class="photo-container" id="photoContainer">
                <img class="photo-preview" id="photoPreview" style="display: none;">
                <canvas class="photo-canvas" id="photoCanvas"></canvas>
            </div>

            <div class="line-info" id="lineInfo" style="display: none;">
                <p><strong>–õ–∏–Ω–∏–∏:</strong></p>
                <p>üî¥ –ú–∞–∫—É—à–∫–∞ (–∫—Ä–∞—Å–Ω–∞—è): <span id="topLineStatus"></span></p>
                <p>üîµ –ü–æ–¥–±–æ—Ä–æ–¥–æ–∫ (—Å–∏–Ω—è—è): <span id="bottomLineStatus"></span></p>
                <p>üü¢ –ì–ª–∞–∑–∞ (–∑–µ–ª—ë–Ω–∞—è): <span id="eyeLineStatus"></span></p>
                <p style="margin-top: 12px; font-size: 12px; color: #999;">–ü–æ—Ç—è–Ω–∏—Ç–µ –ª–∏–Ω–∏–∏ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏</p>
            </div>

            <button class="button button-success" id="cropPhotoBtn" style="display: none;">‚úì –û–±—Ä–µ–∑–∞—Ç—å —Ñ–æ—Ç–æ</button>
            <button class="button button-secondary" id="uploadNewPhotoBtn" style="display: none;">üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ–µ</button>

            <div class="validation-results" id="validationResults">
                <div class="result-status" id="resultStatus"></div>
                <div class="criteria-list" id="criteriaList"></div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Telegram
        const tg = window.Telegram.WebApp;
        tg.ready();

        // App State
        let appState = {
            userId: tg.initDataUnsafe?.user?.id || 'anonymous',
            attempts: 3,
            currentPhoto: null,
            croppedPhoto: null,
            canvas: null,
            ctx: null,
            img: null,
            lines: {
                top: 0,
                bottom: 0,
                eyes: 0
            },
            detections: {
                top: null,
                bottom: null,
                eyes: null
            },
            touchStartY: null,
            draggingLine: null
        };

        // API Configuration
        const API_URL = 'https://dv-lottery-api-ob49.onrender.com';

        // Initialize app with 3 second splash
        setTimeout(async () => {
            document.getElementById('splashScreen').style.display = 'none';
            document.getElementById('mainScreen').classList.add('active');

            // Load attempts from backend
            await loadUserAttempts();

            // Load Face-API models
            loadFaceApiModels();
        }, 3000);

        // Load user attempts from backend
        async function loadUserAttempts() {
            try {
                console.log('Loading attempts for user:', appState.userId);
                const response = await fetch(`${API_URL}/api/user/${appState.userId}`);
                const data = await response.json();
                appState.attempts = data.attempts;
                console.log('‚úÖ Loaded attempts:', appState.attempts, 'Type:', data.type);
                updateAttemptsCounter();
            } catch (error) {
                console.error('Error loading attempts:', error);
                appState.attempts = 3;
                updateAttemptsCounter();
            }
        }

        // Load Face-API Models
        async function loadFaceApiModels() {
            try {
                console.log('Loading Face-API models...');
                const MODEL_URL = 'https://cdn.jsdelivr.net/npm/@vladmandic/face-api@1.7.13/model/';
                
                await Promise.all([
                    faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),
                    faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),
                ]);
                
                console.log('‚úÖ Face-API models loaded successfully');
            } catch (error) {
                console.error('Error loading Face-API models:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π –∞–Ω–∞–ª–∏–∑–∞');
            }
        }

        // Upload Photo
        document.getElementById('uploadPhotoBtn').addEventListener('click', () => {
            if (appState.attempts <= 0) {
                tg.showAlert('–ü–æ–ø—ã—Ç–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å');
                return;
            }
            document.getElementById('photoInput').click();
        });

        document.getElementById('photoInput').addEventListener('change', handlePhotoUpload);

        async function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (e) => {
                appState.currentPhoto = e.target.result;
                document.getElementById('photoPreview').src = appState.currentPhoto;
                document.getElementById('photoPreview').style.display = 'block';
                document.getElementById('loadingSpinner').classList.add('active');
                document.getElementById('lineInfo').style.display = 'none';

                // Setup canvas
                const container = document.getElementById('photoContainer');
                appState.canvas = document.getElementById('photoCanvas');
                appState.ctx = appState.canvas.getContext('2d');
                appState.img = document.getElementById('photoPreview');

                appState.img.onload = async () => {
                    appState.canvas.width = appState.img.naturalWidth;
                    appState.canvas.height = appState.img.naturalHeight;

                    // Detect face landmarks
                    await detectFaceAndSetLines();
                    
                    document.getElementById('loadingSpinner').classList.remove('active');
                    document.getElementById('lineInfo').style.display = 'block';
                    document.getElementById('cropPhotoBtn').style.display = 'block';
                    document.getElementById('uploadNewPhotoBtn').style.display = 'block';
                    
                    setupCanvasInteraction();
                    drawLines();
                };

                // Show photo screen
                document.getElementById('mainScreen').classList.remove('active');
                document.getElementById('photoScreen').classList.add('active');
            };
            reader.readAsDataURL(file);
        }

        // Detect Face and Set Lines
        async function detectFaceAndSetLines() {
            try {
                const detection = await faceapi
                    .detectSingleFace(appState.img, new faceapi.TinyFaceDetectorOptions())
                    .withFaceLandmarks();

                if (detection && detection.landmarks) {
                    const landmarks = detection.landmarks.positions;
                    const box = detection.detection.box;
                    const height = appState.canvas.height;

                    // Calculate line positions
                    const topPoint = Math.min(...landmarks.map(p => p.y)); // Top of head
                    const bottomPoint = Math.max(...landmarks.map(p => p.y)); // Chin
                    const eyePoints = landmarks.slice(36, 48); // Eye landmarks
                    const eyeCenter = eyePoints.reduce((sum, p) => sum + p.y, 0) / eyePoints.length;

                    appState.lines.top = (topPoint / height) * 100;
                    appState.lines.bottom = (bottomPoint / height) * 100;
                    appState.lines.eyes = (eyeCenter / height) * 100;

                    appState.detections.top = 'DETECTED';
                    appState.detections.bottom = 'DETECTED';
                    appState.detections.eyes = 'DETECTED';

                    console.log('‚úÖ Face detected successfully');
                } else {
                    // Fallback: Use approximate positions
                    appState.lines.top = 15;
                    appState.lines.bottom = 70;
                    appState.lines.eyes = 45;

                    appState.detections.top = 'MANUAL';
                    appState.detections.bottom = 'MANUAL';
                    appState.detections.eyes = 'MANUAL';

                    console.log('‚ö†Ô∏è Face not detected, using default positions');
                }

                updateLineStatus();
            } catch (error) {
                console.error('Error detecting face:', error);
                // Set default values
                appState.lines.top = 15;
                appState.lines.bottom = 70;
                appState.lines.eyes = 45;
            }
        }

        // Update Line Status Display
        function updateLineStatus() {
            document.getElementById('topLineStatus').innerHTML = 
                `<span class="${appState.detections.top === 'DETECTED' ? 'detected' : 'manual'}">${appState.detections.top}</span>`;
            document.getElementById('bottomLineStatus').innerHTML = 
                `<span class="${appState.detections.bottom === 'DETECTED' ? 'detected' : 'manual'}">${appState.detections.bottom}</span>`;
            document.getElementById('eyeLineStatus').innerHTML = 
                `<span class="${appState.detections.eyes === 'DETECTED' ? 'detected' : 'manual'}">${appState.detections.eyes}</span>`;
        }

        // Setup Canvas Interaction
        function setupCanvasInteraction() {
            appState.canvas.addEventListener('touchstart', handleTouchStart);
            appState.canvas.addEventListener('touchmove', handleTouchMove);
            appState.canvas.addEventListener('touchend', handleTouchEnd);
            appState.canvas.addEventListener('mousedown', handleMouseDown);
            appState.canvas.addEventListener('mousemove', handleMouseMove);
            appState.canvas.addEventListener('mouseup', handleMouseUp);
        }

        function handleTouchStart(e) {
            appState.touchStartY = e.touches[0].clientY;
            checkLineClick(e.touches[0].clientX, e.touches[0].clientY);
        }

        function handleTouchMove(e) {
            if (!appState.draggingLine) return;
            e.preventDefault();
            const currentY = e.touches[0].clientY;
            adjustLinePosition(currentY - (appState.touchStartY || currentY));
            appState.touchStartY = currentY;
            drawLines();
        }

        function handleTouchEnd() {
            appState.draggingLine = null;
            appState.touchStartY = null;
        }

        function handleMouseDown(e) {
            checkLineClick(e.clientX, e.clientY);
        }

        function handleMouseMove(e) {
            if (!appState.draggingLine) return;
            const rect = appState.canvas.getBoundingClientRect();
            const y = ((e.clientY - rect.top) / rect.height) * 100;
            appState.lines[appState.draggingLine] = Math.max(0, Math.min(100, y));
            drawLines();
        }

        function handleMouseUp() {
            appState.draggingLine = null;
        }

        function checkLineClick(x, y) {
            const rect = appState.canvas.getBoundingClientRect();
            const canvasY = ((y - rect.top) / rect.height) * 100;

            const threshold = 5;
            if (Math.abs(canvasY - appState.lines.top) < threshold) {
                appState.draggingLine = 'top';
            } else if (Math.abs(canvasY - appState.lines.bottom) < threshold) {
                appState.draggingLine = 'bottom';
            } else if (Math.abs(canvasY - appState.lines.eyes) < threshold) {
                appState.draggingLine = 'eyes';
            }
        }

        function adjustLinePosition(delta) {
            if (!appState.draggingLine) return;
            const rect = appState.canvas.getBoundingClientRect();
            const percentDelta = (delta / rect.height) * 100;
            appState.lines[appState.draggingLine] = Math.max(0, Math.min(100, appState.lines[appState.draggingLine] + percentDelta));
        }

        // Draw Lines
        function drawLines() {
            appState.ctx.clearRect(0, 0, appState.canvas.width, appState.canvas.height);
            const height = appState.canvas.height;

            // Red line - top
            appState.ctx.strokeStyle = '#F44336';
            appState.ctx.lineWidth = 3;
            appState.ctx.beginPath();
            appState.ctx.moveTo(0, (appState.lines.top / 100) * height);
            appState.ctx.lineTo(appState.canvas.width, (appState.lines.top / 100) * height);
            appState.ctx.stroke();

            // Blue line - bottom
            appState.ctx.strokeStyle = '#2196F3';
            appState.ctx.lineWidth = 3;
            appState.ctx.beginPath();
            appState.ctx.moveTo(0, (appState.lines.bottom / 100) * height);
            appState.ctx.lineTo(appState.canvas.width, (appState.lines.bottom / 100) * height);
            appState.ctx.stroke();

            // Green dashed line - eyes
            appState.ctx.strokeStyle = '#4CAF50';
            appState.ctx.lineWidth = 2;
            appState.ctx.setLineDash([5, 5]);
            appState.ctx.beginPath();
            appState.ctx.moveTo(0, (appState.lines.eyes / 100) * height);
            appState.ctx.lineTo(appState.canvas.width, (appState.lines.eyes / 100) * height);
            appState.ctx.stroke();
            appState.ctx.setLineDash([]);

            // Vertical center line
            appState.ctx.strokeStyle = 'rgba(33, 150, 243, 0.3)';
            appState.ctx.setLineDash([5, 5]);
            appState.ctx.beginPath();
            appState.ctx.moveTo(appState.canvas.width / 2, 0);
            appState.ctx.lineTo(appState.canvas.width / 2, appState.canvas.height);
            appState.ctx.stroke();
            appState.ctx.setLineDash([]);
        }

        // Crop Photo
        document.getElementById('cropPhotoBtn').addEventListener('click', async () => {
            document.getElementById('loadingSpinner').classList.add('active');
            document.getElementById('cropPhotoBtn').style.display = 'none';

            try {
                // Send to backend for processing
                const response = await fetch(`${API_URL}/api/process-photo`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: appState.userId,
                        photo: appState.currentPhoto,
                        lines: appState.lines
                    })
                });

                const result = await response.json();

                if (result.success) {
                    appState.croppedPhoto = result.croppedPhoto;
                    document.getElementById('photoPreview').src = appState.croppedPhoto;
                    drawLines(); // Redraw lines on cropped photo
                    displayValidationResults(result.validation);
                    appState.attempts = result.remainingAttempts;
                    updateAttemptsCounter();
                } else {
                    tg.showAlert(result.error || '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏');
                }
            } catch (error) {
                console.error('Error processing photo:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ');
            } finally {
                document.getElementById('loadingSpinner').classList.remove('active');
            }
        });

        // Display Validation Results
        function displayValidationResults(validation) {
            const resultsDiv = document.getElementById('validationResults');
            const statusDiv = document.getElementById('resultStatus');
            const criteriaList = document.getElementById('criteriaList');

            resultsDiv.classList.add('active');

            const allValid = validation.criteria.every(c => c.passed);
            statusDiv.className = `result-status ${allValid ? 'success' : 'error'}`;
            statusDiv.textContent = allValid ? '‚úÖ –§–æ—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º' : '‚ùå –§–æ—Ç–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º';

            criteriaList.innerHTML = validation.criteria.map(criterion => `
                <div class="criteria-item">
                    <svg class="criteria-icon" viewBox="0 0 24 24" fill="${criterion.passed ? '#4CAF50' : '#F44336'}">
                        ${criterion.passed ? 
                            '<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>' :
                            '<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>'
                        }
                    </svg>
                    <div class="criteria-label">${criterion.name}</div>
                    <div class="criteria-value">${criterion.value}</div>
                </div>
            `).join('');
        }

        // Update Attempts Counter
        function updateAttemptsCounter() {
            document.getElementById('attemptsCount').textContent = appState.attempts;
        }

        // Back Button
        document.getElementById('backFromPhoto').addEventListener('click', () => {
            appState.currentPhoto = null;
            appState.croppedPhoto = null;
            document.getElementById('photoPreview').style.display = 'none';
            document.getElementById('lineInfo').style.display = 'none';
            document.getElementById('cropPhotoBtn').style.display = 'none';
            document.getElementById('uploadNewPhotoBtn').style.display = 'none';
            document.getElementById('validationResults').classList.remove('active');
            document.getElementById('photoScreen').classList.remove('active');
            document.getElementById('mainScreen').classList.add('active');
        });

        document.getElementById('uploadNewPhotoBtn').addEventListener('click', () => {
            document.getElementById('photoInput').click();
        });

        document.getElementById('instructionsBtn').addEventListener('click', () => {
            tg.showAlert('üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\n\n‚Ä¢ –ö–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ —Ñ–æ—Ç–æ 600√ó600 –ø–∏–∫—Å–µ–ª–µ–π\n‚Ä¢ –ì–æ–ª–æ–≤–∞ –∑–∞–Ω–∏–º–∞–µ—Ç 50-69% –≤—ã—Å–æ—Ç—ã\n‚Ä¢ –û–±–∞ –≥–ª–∞–∑–∞ –æ—Ç–∫—Ä—ã—Ç—ã\n‚Ä¢ –°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω\n‚Ä¢ –§–æ—Ç–æ –Ω–µ —Å—Ç–∞—Ä—à–µ 6 –º–µ—Å—è—Ü–µ–≤');
        });
    </script>
</body>
</html>


