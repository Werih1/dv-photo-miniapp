<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DV Lottery Photo Check</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #2481cc;
            --tg-theme-button-color: #2481cc;
            --tg-theme-button-text-color: #ffffff;
            --primary-blue: #2196F3;
            --success-green: #4CAF50;
            --error-red: #F44336;
            --warning-orange: #FF9800;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .app-container {
            max-width: 100vw;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Splash Screen */
        .splash-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            animation: fadeIn 0.5s;
        }

        .splash-logo {
            width: 200px;
            height: 200px;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }

        .splash-title {
            font-size: 28px;
            font-weight: bold;
            color: white;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .splash-subtitle {
            font-size: 16px;
            color: rgba(255,255,255,0.9);
            text-align: center;
            margin-bottom: 40px;
        }

        /* Main Screen */
        .main-screen {
            padding: 20px;
            display: none;
        }

        .main-screen.active {
            display: block;
            animation: slideIn 0.3s;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .attempts-counter {
            display: inline-block;
            padding: 8px 16px;
            background: var(--primary-blue);
            color: white;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .button {
            width: 100%;
            padding: 16px;
            margin-bottom: 12px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .button:active {
            transform: scale(0.98);
        }

        .button-secondary {
            background: #f5f5f5;
            color: #333;
        }

        .button-success {
            background: var(--success-green);
        }

        .button-small {
            width: auto;
            padding: 12px 24px;
            font-size: 14px;
        }

        /* Photo Upload Screen */
        .photo-screen {
            display: none;
            padding: 20px;
        }

        .photo-screen.active {
            display: block;
            animation: slideIn 0.3s;
        }

        .photo-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto 20px;
            background: #f0f0f0;
            border-radius: 12px;
            overflow: hidden;
        }

        .photo-preview {
            width: 100%;
            display: block;
        }

        .photo-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .line-controls {
            display: none;
            margin-top: 20px;
        }

        .line-controls.active {
            display: block;
        }

        .line-control {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .line-label {
            width: 120px;
            font-size: 14px;
            font-weight: 500;
        }

        .line-slider {
            flex: 1;
            height: 40px;
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
        }

        .line-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .line-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
            border: none;
        }

        .line-slider.red::-webkit-slider-thumb {
            background: var(--error-red);
        }

        .line-slider.blue::-webkit-slider-thumb {
            background: var(--primary-blue);
        }

        .line-slider.green::-webkit-slider-thumb {
            background: var(--success-green);
        }

        /* Validation Results */
        .validation-results {
            display: none;
            margin-top: 20px;
        }

        .validation-results.active {
            display: block;
        }

        .result-status {
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .result-status.success {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success-green);
            border: 2px solid var(--success-green);
        }

        .result-status.error {
            background: rgba(244, 67, 54, 0.1);
            color: var(--error-red);
            border: 2px solid var(--error-red);
        }

        .criteria-list {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .criteria-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .criteria-item:last-child {
            border-bottom: none;
        }

        .criteria-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .criteria-label {
            flex: 1;
            font-size: 14px;
        }

        .criteria-value {
            font-size: 14px;
            font-weight: 500;
            color: #666;
        }

        /* Tariffs Screen */
        .tariffs-screen {
            display: none;
            padding: 20px;
        }

        .tariffs-screen.active {
            display: block;
            animation: slideIn 0.3s;
        }

        .tariff-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .tariff-card.featured {
            border-color: var(--primary-blue);
            box-shadow: 0 6px 16px rgba(33, 150, 243, 0.3);
        }

        .tariff-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .tariff-attempts {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
        }

        .tariff-price {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 16px;
        }

        .tariff-validity {
            font-size: 12px;
            color: #999;
            margin-bottom: 16px;
        }

        .promo-section {
            margin-top: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 12px;
        }

        .promo-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
        }

        /* Language Selector */
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .lang-flag {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
            background-size: cover;
        }

        .lang-flag.active {
            border-color: var(--primary-blue);
            transform: scale(1.1);
        }

        /* Instructions Screen */
        .instructions-screen {
            display: none;
            padding: 20px;
        }

        .instructions-screen.active {
            display: block;
            animation: slideIn 0.3s;
        }

        .instruction-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .instruction-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        /* News Screen */
        .news-screen {
            display: none;
            padding: 20px;
        }

        .news-screen.active {
            display: block;
            animation: slideIn 0.3s;
        }

        .news-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .news-date {
            font-size: 12px;
            color: #999;
            margin-bottom: 8px;
        }

        .news-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .back-button {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            color: var(--primary-blue);
            cursor: pointer;
            font-size: 16px;
        }

        .back-button svg {
            margin-right: 8px;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Hidden file input */
        .hidden-input {
            display: none;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading-spinner.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Language Selector -->
        <div class="language-selector">
            <div class="lang-flag active" data-lang="ru" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjEwLjY3IiBmaWxsPSIjZmZmIi8+PHJlY3QgeT0iMTAuNjciIHdpZHRoPSIzMiIgaGVpZ2h0PSIxMC42NyIgZmlsbD0iIzAwZiIvPjxyZWN0IHk9IjIxLjMzIiB3aWR0aD0iMzIiIGhlaWdodD0iMTAuNjciIGZpbGw9IiNmMDAiLz48L3N2Zz4=');" title="–†—É—Å—Å–∫–∏–π"></div>
            <div class="lang-flag" data-lang="en" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiBmaWxsPSIjMDEyMTY5Ii8+PHBhdGggZD0iTTAgMGgzMnYzMkgweiIgZmlsbD0iIzAxMjE2OSIvPjwvc3ZnPg==');" title="English"></div>
            <div class="lang-flag" data-lang="es" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjgiIGZpbGw9IiNjNjBiMWUiLz48cmVjdCB5PSI4IiB3aWR0aD0iMzIiIGhlaWdodD0iMTYiIGZpbGw9IiNmZmMyMDAiLz48cmVjdCB5PSIyNCIgd2lkdGg9IjMyIiBoZWlnaHQ9IjgiIGZpbGw9IiNjNjBiMWUiLz48L3N2Zz4=');" title="Espa√±ol"></div>
        </div>

        <!-- Splash Screen -->
        <div class="splash-screen" id="splashScreen">
            <img class="splash-logo" src="${LOGO_URL}" alt="DV Lottery Logo" id="splashLogo">
            <div class="splash-title">DV Lottery Photo Check</div>
            <div class="splash-subtitle">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ç–æ –¥–ª—è –ª–æ—Ç–µ—Ä–µ–∏ Green Card</div>
        </div>

        <!-- Main Screen -->
        <div class="main-screen" id="mainScreen">
            <div class="header">
                <h1 class="header-title">DV Lottery Photo</h1>
                <div class="attempts-counter" id="attemptsCounter">
                    –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: <span id="attemptsCount">3</span>
                </div>
            </div>

            <button class="button" id="uploadPhotoBtn">
                üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            </button>
            <button class="button button-secondary" id="instructionsBtn">
                üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
            </button>
            <button class="button button-secondary" id="newsBtn">
                üì∞ –ù–æ–≤–æ—Å—Ç–∏ –ª–æ—Ç–µ—Ä–µ–∏ Green Card
            </button>
            <button class="button button-secondary" id="tariffsBtn">
                üí≥ –¢–∞—Ä–∏—Ñ—ã
            </button>
        </div>

        <!-- Photo Upload Screen -->
        <div class="photo-screen" id="photoScreen">
            <div class="back-button" id="backFromPhoto">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                –ù–∞–∑–∞–¥
            </div>

            <input type="file" id="photoInput" class="hidden-input" accept="image/*">

            <div class="photo-container" id="photoContainer">
                <img class="photo-preview" id="photoPreview" style="display: none;">
                <canvas class="photo-canvas" id="photoCanvas"></canvas>
            </div>

            <div class="line-controls" id="lineControls">
                <div class="line-control">
                    <div class="line-label">üî¥ –ú–∞–∫—É—à–∫–∞:</div>
                    <input type="range" class="line-slider red" id="topLineSlider" min="0" max="100" value="10">
                </div>
                <div class="line-control">
                    <div class="line-label">üîµ –ü–æ–¥–±–æ—Ä–æ–¥–æ–∫:</div>
                    <input type="range" class="line-slider blue" id="bottomLineSlider" min="0" max="100" value="70">
                </div>
                <div class="line-control">
                    <div class="line-label">üü¢ –£—Ä–æ–≤–µ–Ω—å –≥–ª–∞–∑:</div>
                    <input type="range" class="line-slider green" id="eyeLineSlider" min="0" max="100" value="35">
                </div>
            </div>

            <button class="button button-success" id="cropPhotoBtn" style="display: none;">
                ‚úÇÔ∏è –û–±—Ä–µ–∑–∞—Ç—å —Ñ–æ—Ç–æ
            </button>

            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
                <div>–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é...</div>
            </div>

            <div class="validation-results" id="validationResults">
                <div class="result-status" id="resultStatus"></div>
                
                <div class="criteria-list" id="criteriaList"></div>

                <button class="button" id="savePhotoBtn" style="margin-top: 20px;">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ç–æ
                </button>
                <button class="button button-secondary" id="uploadNewPhotoBtn">
                    üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ
                </button>
            </div>
        </div>

        <!-- Tariffs Screen -->
        <div class="tariffs-screen" id="tariffsScreen">
            <div class="back-button" id="backFromTariffs">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                –ù–∞–∑–∞–¥
            </div>

            <h2 style="margin-bottom: 20px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ</h2>

            <div class="tariff-card">
                <div class="tariff-name">Solo Plan</div>
                <div class="tariff-attempts">10 –ø–æ–ø—ã—Ç–æ–∫</div>
                <div class="tariff-price">99 ‚≠ê</div>
                <div class="tariff-validity">–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ 1 –∏—é–ª—è</div>
                <button class="button" data-tariff="solo">–ö—É–ø–∏—Ç—å</button>
            </div>

            <div class="tariff-card featured">
                <div class="tariff-name">–°–µ–º–µ–π–Ω—ã–π –ø–ª–∞–Ω DV</div>
                <div class="tariff-attempts">30 –ø–æ–ø—ã—Ç–æ–∫</div>
                <div class="tariff-price">249 ‚≠ê</div>
                <div class="tariff-validity">–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ 1 –∏—é–ª—è</div>
                <button class="button" data-tariff="family">–ö—É–ø–∏—Ç—å</button>
            </div>

            <div class="tariff-card">
                <div class="tariff-name">Agency PRO DV</div>
                <div class="tariff-attempts">–ë–µ–∑–ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫</div>
                <div class="tariff-price">2499 ‚≠ê</div>
                <div class="tariff-validity">–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ 1 –∏—é–ª—è</div>
                <button class="button" data-tariff="agency">–ö—É–ø–∏—Ç—å</button>
            </div>

            <div class="promo-section">
                <h3 style="margin-bottom: 12px;">–ï—Å—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥?</h3>
                <input type="text" class="promo-input" id="promoInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
                <button class="button button-secondary" id="applyPromoBtn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>
        </div>

        <!-- Instructions Screen -->
        <div class="instructions-screen" id="instructionsScreen">
            <div class="back-button" id="backFromInstructions">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                –ù–∞–∑–∞–¥
            </div>

            <h2 style="margin-bottom: 20px;">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ñ–æ—Ç–æ</h2>

            <div class="instruction-item">
                <div class="instruction-title">üìè –†–∞–∑–º–µ—Ä—ã —Ñ–æ—Ç–æ</div>
                <p>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–π: 600√ó600 –ø–∏–∫—Å–µ–ª–µ–π</p>
            </div>

            <div class="instruction-item">
                <div class="instruction-title">üë§ –ü–æ–ª–æ–∂–µ–Ω–∏–µ –ª–∏—Ü–∞</div>
                <p>–ì–æ–ª–æ–≤–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–Ω–∏–º–∞—Ç—å 50-69% –≤—ã—Å–æ—Ç—ã —Ñ–æ—Ç–æ. –õ–∏—Ü–æ —Å—Ç—Ä–æ–≥–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É, –±–µ–∑ –Ω–∞–∫–ª–æ–Ω–∞.</p>
            </div>

            <div class="instruction-item">
                <div class="instruction-title">üëÅÔ∏è –ì–ª–∞–∑–∞</div>
                <p>–û–±–∞ –≥–ª–∞–∑–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã, –±–µ–∑ —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫—Ä–∞—Å–Ω—ã—Ö –≥–ª–∞–∑. –õ–∏–Ω–∏—è –≥–ª–∞–∑ –Ω–∞ —É—Ä–æ–≤–Ω–µ 56-69% –≤—ã—Å–æ—Ç—ã.</p>
            </div>

            <div class="instruction-item">
                <div class="instruction-title">üé® –§–æ–Ω</div>
                <p>–§–æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–≤–µ—Ç–ª—ã–º, –æ–¥–Ω–æ—Ä–æ–¥–Ω—ã–º, –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ (–±–µ–ª—ã–π –∏–ª–∏ —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π).</p>
            </div>

            <div class="instruction-item">
                <div class="instruction-title">üí° –û—Å–≤–µ—â–µ–Ω–∏–µ</div>
                <p>–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –±–µ–∑ —Ç–µ–Ω–µ–π –Ω–∞ –ª–∏—Ü–µ –∏ —Ñ–æ–Ω–µ.</p>
            </div>

            <div class="instruction-item">
                <div class="instruction-title">üìÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å</div>
                <p>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç–∞—Ä—à–µ 6 –º–µ—Å—è—Ü–µ–≤.</p>
            </div>

            <div class="instruction-item">
                <div class="instruction-title">üëì –û—á–∫–∏ –∏ –≥–æ–ª–æ–≤–Ω—ã–µ —É–±–æ—Ä—ã</div>
                <p>–û—á–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã, –µ—Å–ª–∏ –≤–∏–¥–Ω—ã –≥–ª–∞–∑–∞. –ì–æ–ª–æ–≤–Ω—ã–µ —É–±–æ—Ä—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã (–∫—Ä–æ–º–µ —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã—Ö).</p>
            </div>
        </div>

        <!-- News Screen -->
        <div class="news-screen" id="newsScreen">
            <div class="back-button" id="backFromNews">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                –ù–∞–∑–∞–¥
            </div>

            <h2 style="margin-bottom: 20px;">–ù–æ–≤–æ—Å—Ç–∏ Green Card</h2>

            <div id="newsList">
                <div class="news-item">
                    <div class="news-date">24 –Ω–æ—è–±—Ä—è 2025</div>
                    <div class="news-title">DV-2027: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞!</div>
                    <p>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–∞—á–∞–ª–∞—Å—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ª–æ—Ç–µ—Ä–µ—é DV-2027. –ü—Ä–∏–µ–º –∑–∞—è–≤–æ–∫ –¥–æ 5 –Ω–æ—è–±—Ä—è 2025 –≥–æ–¥–∞.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // App State
        let appState = {
            userId: tg.initDataUnsafe?.user?.id || 'demo',
            attempts: 3,
            currentPhoto: null,
            lines: {
                top: 10,
                bottom: 70,
                eyes: 35
            },
            language: 'ru',
            croppedPhoto: null
        };

        // Translations
        const translations = {
            ru: {
                attemptsLeft: '–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫:',
                uploadPhoto: 'üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏',
                instructions: 'üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è',
                news: 'üì∞ –ù–æ–≤–æ—Å—Ç–∏ –ª–æ—Ç–µ—Ä–µ–∏ Green Card',
                tariffs: 'üí≥ –¢–∞—Ä–∏—Ñ—ã',
                back: '–ù–∞–∑–∞–¥',
                cropPhoto: '‚úÇÔ∏è –û–±—Ä–µ–∑–∞—Ç—å —Ñ–æ—Ç–æ',
                savePhoto: 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ç–æ',
                uploadNew: 'üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ',
                analyzing: '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é...',
                photoMeets: '–§–æ—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º',
                photoDoesNotMeet: '–§–æ—Ç–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º',
                topLine: 'üî¥ –ú–∞–∫—É—à–∫–∞:',
                bottomLine: 'üîµ –ü–æ–¥–±–æ—Ä–æ–¥–æ–∫:',
                eyeLine: 'üü¢ –£—Ä–æ–≤–µ–Ω—å –≥–ª–∞–∑:'
            },
            en: {
                attemptsLeft: 'Attempts left:',
                uploadPhoto: 'üì∏ Upload photo for verification',
                instructions: 'üìã Instructions',
                news: 'üì∞ Green Card Lottery News',
                tariffs: 'üí≥ Plans',
                back: 'Back',
                cropPhoto: '‚úÇÔ∏è Crop photo',
                savePhoto: 'üíæ Save photo',
                uploadNew: 'üì∏ Upload new photo',
                analyzing: 'Analyzing photo...',
                photoMeets: 'Photo meets requirements',
                photoDoesNotMeet: 'Photo does not meet requirements',
                topLine: 'üî¥ Top of head:',
                bottomLine: 'üîµ Chin:',
                eyeLine: 'üü¢ Eye level:'
            },
            es: {
                attemptsLeft: 'Intentos restantes:',
                uploadPhoto: 'üì∏ Subir foto para verificaci√≥n',
                instructions: 'üìã Instrucciones',
                news: 'üì∞ Noticias de la loter√≠a Green Card',
                tariffs: 'üí≥ Planes',
                back: 'Atr√°s',
                cropPhoto: '‚úÇÔ∏è Recortar foto',
                savePhoto: 'üíæ Guardar foto',
                uploadNew: 'üì∏ Subir nueva foto',
                analyzing: 'Analizando fotograf√≠a...',
                photoMeets: 'La foto cumple con los requisitos',
                photoDoesNotMeet: 'La foto no cumple con los requisitos',
                topLine: 'üî¥ Parte superior:',
                bottomLine: 'üîµ Barbilla:',
                eyeLine: 'üü¢ Nivel de ojos:'
            }
        };

        // API Configuration
        const API_URL = 'YOUR_BACKEND_API_URL'; // Replace with your backend URL

        // Initialize app
        setTimeout(() => {
            document.getElementById('splashScreen').style.display = 'none';
            document.getElementById('mainScreen').classList.add('active');
            loadUserData();
        }, 2000);

        // Load user data
        async function loadUserData() {
            try {
                const response = await fetch(`${API_URL}/api/user/${appState.userId}`);
                const data = await response.json();
                appState.attempts = data.attempts || 3;
                updateAttemptsCounter();
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        function updateAttemptsCounter() {
            document.getElementById('attemptsCount').textContent = appState.attempts;
        }

        // Screen Navigation
        function showScreen(screenId) {
            document.querySelectorAll('.main-screen, .photo-screen, .tariffs-screen, .instructions-screen, .news-screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Event Listeners
        document.getElementById('uploadPhotoBtn').addEventListener('click', () => {
            if (appState.attempts <= 0) {
                tg.showAlert('–£ –≤–∞—Å –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –ø–æ–ø—ã—Ç–∫–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–æ–±—Ä–µ—Ç–∏—Ç–µ —Ç–∞—Ä–∏—Ñ.');
                showScreen('tariffsScreen');
                return;
            }
            showScreen('photoScreen');
            document.getElementById('photoInput').click();
        });

        document.getElementById('instructionsBtn').addEventListener('click', () => showScreen('instructionsScreen'));
        document.getElementById('newsBtn').addEventListener('click', () => showScreen('newsScreen'));
        document.getElementById('tariffsBtn').addEventListener('click', () => showScreen('tariffsScreen'));

        document.getElementById('backFromPhoto').addEventListener('click', () => showScreen('mainScreen'));
        document.getElementById('backFromTariffs').addEventListener('click', () => showScreen('mainScreen'));
        document.getElementById('backFromInstructions').addEventListener('click', () => showScreen('mainScreen'));
        document.getElementById('backFromNews').addEventListener('click', () => showScreen('mainScreen'));

        // Photo Upload
        document.getElementById('photoInput').addEventListener('change', handlePhotoUpload);

        async function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (e) => {
                appState.currentPhoto = e.target.result;
                const preview = document.getElementById('photoPreview');
                preview.src = appState.currentPhoto;
                preview.style.display = 'block';

                // Detect face and set lines
                await detectFaceAndSetLines();
                
                document.getElementById('lineControls').classList.add('active');
                document.getElementById('cropPhotoBtn').style.display = 'block';
                
                drawLines();
            };
            reader.readAsDataURL(file);
        }

        async function detectFaceAndSetLines() {
            // Simulate face detection (in real app, use face-api.js or backend API)
            const canvas = document.getElementById('photoCanvas');
            const img = document.getElementById('photoPreview');
            
            canvas.width = img.naturalWidth;
            canvas.height = img.naturalHeight;

            // Auto-detect approximate positions (simplified)
            appState.lines.top = 15;
            appState.lines.eyes = 38;
            appState.lines.bottom = 65;

            updateSliders();
        }

        function updateSliders() {
            document.getElementById('topLineSlider').value = appState.lines.top;
            document.getElementById('eyeLineSlider').value = appState.lines.eyes;
            document.getElementById('bottomLineSlider').value = appState.lines.bottom;
        }

        // Line Drawing
        function drawLines() {
            const canvas = document.getElementById('photoCanvas');
            const ctx = canvas.getContext('2d');
            const img = document.getElementById('photoPreview');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const height = canvas.height;
            
            // Red line (top)
            ctx.strokeStyle = '#F44336';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, (appState.lines.top / 100) * height);
            ctx.lineTo(canvas.width, (appState.lines.top / 100) * height);
            ctx.stroke();

            // Blue line (bottom)
            ctx.strokeStyle = '#2196F3';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, (appState.lines.bottom / 100) * height);
            ctx.lineTo(canvas.width, (appState.lines.bottom / 100) * height);
            ctx.stroke();

            // Green line (eyes)
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 3;
            ctx.setLineDash([10, 5]);
            ctx.beginPath();
            ctx.moveTo(0, (appState.lines.eyes / 100) * height);
            ctx.lineTo(canvas.width, (appState.lines.eyes / 100) * height);
            ctx.stroke();
            ctx.setLineDash([]);

            // Vertical center line (will show after crop)
            if (appState.croppedPhoto) {
                ctx.strokeStyle = 'rgba(33, 150, 243, 0.5)';
                ctx.setLineDash([10, 5]);
                ctx.beginPath();
                ctx.moveTo(canvas.width / 2, 0);
                ctx.lineTo(canvas.width / 2, canvas.height);
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }

        // Slider Events
        ['topLineSlider', 'eyeLineSlider', 'bottomLineSlider'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                const lineType = id.replace('LineSlider', '');
                const key = lineType === 'top' ? 'top' : lineType === 'eye' ? 'eyes' : 'bottom';
                appState.lines[key] = parseInt(e.target.value);
                drawLines();
            });
        });

        // Crop Photo
        document.getElementById('cropPhotoBtn').addEventListener('click', async () => {
            document.getElementById('loadingSpinner').classList.add('active');
            
            try {
                // Send to backend for processing
                const response = await fetch(`${API_URL}/api/process-photo`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: appState.userId,
                        photo: appState.currentPhoto,
                        lines: appState.lines
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    appState.croppedPhoto = result.croppedPhoto;
                    appState.attempts = result.remainingAttempts;
                    updateAttemptsCounter();
                    
                    // Update preview with cropped photo
                    document.getElementById('photoPreview').src = appState.croppedPhoto;
                    drawLines();
                    
                    // Show validation results
                    displayValidationResults(result.validation);
                } else {
                    tg.showAlert(result.error || '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ç–æ');
                }
            } catch (error) {
                console.error('Error processing photo:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            } finally {
                document.getElementById('loadingSpinner').classList.remove('active');
            }
        });

        function displayValidationResults(validation) {
            const resultsDiv = document.getElementById('validationResults');
            const statusDiv = document.getElementById('resultStatus');
            const criteriaList = document.getElementById('criteriaList');

            resultsDiv.classList.add('active');

            // Set status
            const allValid = validation.criteria.every(c => c.passed);
            statusDiv.className = 'result-status ' + (allValid ? 'success' : 'error');
            statusDiv.textContent = allValid ? translations[appState.language].photoMeets : translations[appState.language].photoDoesNotMeet;

            // Display criteria
            criteriaList.innerHTML = validation.criteria.map(criterion => `
                <div class="criteria-item">
                    <svg class="criteria-icon" viewBox="0 0 24 24" fill="${criterion.passed ? '#4CAF50' : '#F44336'}">
                        ${criterion.passed 
                            ? '<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>'
                            : '<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>'
                        }
                    </svg>
                    <div class="criteria-label">${criterion.name}</div>
                    <div class="criteria-value">${criterion.value}</div>
                </div>
            `).join('');
        }

        // Save Photo
        document.getElementById('savePhotoBtn').addEventListener('click', () => {
            if (!appState.croppedPhoto) return;
            
            const link = document.createElement('a');
            link.download = 'dv-lottery-photo.jpg';
            link.href = appState.croppedPhoto;
            link.click();
            
            tg.showAlert('–§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
        });

        // Upload New Photo
        document.getElementById('uploadNewPhotoBtn').addEventListener('click', () => {
            if (appState.attempts <= 0) {
                tg.showAlert('–£ –≤–∞—Å –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –ø–æ–ø—ã—Ç–∫–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–æ–±—Ä–µ—Ç–∏—Ç–µ —Ç–∞—Ä–∏—Ñ.');
                showScreen('tariffsScreen');
                return;
            }
            
            appState.currentPhoto = null;
            appState.croppedPhoto = null;
            document.getElementById('photoPreview').style.display = 'none';
            document.getElementById('lineControls').classList.remove('active');
            document.getElementById('cropPhotoBtn').style.display = 'none';
            document.getElementById('validationResults').classList.remove('active');
            document.getElementById('photoInput').click();
        });

        // Tariff Purchase
        document.querySelectorAll('[data-tariff]').forEach(btn => {
            btn.addEventListener('click', async (e) => {
                const tariff = e.target.dataset.tariff;
                const prices = { solo: 99, family: 249, agency: 2499 };
                
                try {
                    // Initiate Telegram payment
                    tg.openInvoice(`${API_URL}/api/create-invoice?userId=${appState.userId}&tariff=${tariff}`, (status) => {
                        if (status === 'paid') {
                            tg.showAlert('–¢–∞—Ä–∏—Ñ —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');
                            loadUserData();
                            showScreen('mainScreen');
                        }
                    });
                } catch (error) {
                    console.error('Payment error:', error);
                    tg.showAlert('–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã');
                }
            });
        });

        // Promo Code
        document.getElementById('applyPromoBtn').addEventListener('click', async () => {
            const promoCode = document.getElementById('promoInput').value.trim();
            if (!promoCode) return;

            try {
                const response = await fetch(`${API_URL}/api/apply-promo`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: appState.userId,
                        promoCode: promoCode
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    appState.attempts = result.newAttempts;
                    updateAttemptsCounter();
                    tg.showAlert(`–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω! –î–æ–±–∞–≤–ª–µ–Ω–æ ${result.addedAttempts} –ø–æ–ø—ã—Ç–æ–∫.`);
                    document.getElementById('promoInput').value = '';
                } else {
                    tg.showAlert(result.error || '–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥');
                }
            } catch (error) {
                console.error('Promo code error:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞');
            }
        });

        // Language Switcher
        document.querySelectorAll('.lang-flag').forEach(flag => {
            flag.addEventListener('click', (e) => {
                document.querySelectorAll('.lang-flag').forEach(f => f.classList.remove('active'));
                e.target.classList.add('active');
                appState.language = e.target.dataset.lang;
                updateLanguage();
            });
        });

        function updateLanguage() {
            // Update all text elements based on current language
            const t = translations[appState.language];
            // Implement translation updates here
        }

        // Set Telegram theme colors
        document.documentElement.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color || '#ffffff');
        document.documentElement.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color || '#000000');
    </script>
</body>
</html>